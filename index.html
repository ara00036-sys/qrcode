<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QR Code Generator</title>
  <link rel="stylesheet" href="styles.css" />
  <!-- QRious for generating QR code into a canvas -->
  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
</head>
<body>
  <main class="container">
    <h1>QR Code Generator</h1>

    <label for="textInput" class="label">Enter a URL or any text</label>
    <textarea id="textInput" rows="2" placeholder="https://example.com or some text"></textarea>

    <div class="controls">
      <label for="sizeRange" class="label">Size: <span id="sizeValue">256</span> px</label>
      <input id="sizeRange" type="range" min="128" max="1024" value="256" />

      <button id="generateBtn" class="btn">Generate QR</button>
      <a id="downloadLink" class="btn btn-primary" download="qrcode.png" href="#">Download PNG</a>
    </div>

    <section class="preview">
      <h2>Preview</h2>
      <canvas id="qrCanvas" width="256" height="256" aria-label="Generated QR code"></canvas>
      <p id="previewText" class="muted"></p>
    </section>

    <section class="test">
      <h2>Quick Test</h2>
      <p>Try the sample URL: <button id="sampleBtn" class="btn small">https://example.com</button></p>
    </section>

    <footer class="foot">
      <p>Static page â€” works offline once downloaded. Ready for GitHub Pages.</p>
    </footer>
  </main>

  <script>
    // Elements
    const textInput = document.getElementById('textInput');
    const generateBtn = document.getElementById('generateBtn');
    const downloadLink = document.getElementById('downloadLink');
    const qrCanvas = document.getElementById('qrCanvas');
    const sizeRange = document.getElementById('sizeRange');
    const sizeValue = document.getElementById('sizeValue');
    const previewText = document.getElementById('previewText');
    const sampleBtn = document.getElementById('sampleBtn');

    // Create QRious instance bound to the canvas
    let qr = new QRious({
      element: qrCanvas,
      value: '',
      size: Number(sizeRange.value),
      level: 'H' // high error correction
    });

    function updateDownloadLink() {
      try {
        const dataUrl = qr.toDataURL('image/png');
        downloadLink.href = dataUrl;
        downloadLink.download = 'qrcode.png';
        downloadLink.classList.remove('disabled');
      } catch (err) {
        // In some browsers canvas may be tainted if external images used; not applicable here.
        downloadLink.href = '#';
        downloadLink.classList.add('disabled');
      }
    }

    function generate() {
      const val = textInput.value.trim();
      if (!val) {
        alert('Please enter a URL or some text to encode.');
        return;
      }
      const size = Number(sizeRange.value) || 256;
      qr.size = size;
      qr.value = val;
      // update canvas size attribute for good measure
      qrCanvas.width = size;
      qrCanvas.height = size;

      previewText.textContent = val;
      updateDownloadLink();
    }

    // Events
    generateBtn.addEventListener('click', generate);
    sizeRange.addEventListener('input', () => {
      sizeValue.textContent = sizeRange.value;
      // live update size but don't regenerate value unless there is text
      qr.size = Number(sizeRange.value);
      qrCanvas.width = Number(sizeRange.value);
      qrCanvas.height = Number(sizeRange.value);
      if (textInput.value.trim()) {
        qr.value = textInput.value.trim();
        updateDownloadLink();
      }
    });

    textInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
        // Ctrl+Enter or Cmd+Enter generates the QR
        generate();
      }
    });

    sampleBtn.addEventListener('click', () => {
      textInput.value = 'https://example.com';
      generate();
    });

    // Initialize with a sample
    textInput.value = 'https://example.com';
    generate();

    // If user clicks Download anchor and href is '#', prevent default
    downloadLink.addEventListener('click', (e) => {
      if (downloadLink.href === '#' || downloadLink.classList.contains('disabled')) {
        e.preventDefault();
      }
    });

  </script>
</body>
</html>